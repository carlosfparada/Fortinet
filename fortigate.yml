---

- name: Get dynamic Fortinet nodes and assign them to groups
  hosts: localhost
  connection: local
  gather_facts: no
  vars_files: 
    - main.yml
  tasks:
    - include_role: utils_dynamic_hosts
      when: infra == 'vmware'
    - include_role: utils_hosts_aws
      when: infra == 'aws'

- name: Fortinet FortiGate setup roles
  hosts: localhost
  connection: local
  gather_facts: no
  vars_files: 
    - main.yml
    - "{{infra}}.yml"  
  tasks:
    - include_role: fortigate_initial_setup
      when: infra == 'vmware'
    
- name: Fortinet FortiGate roles
  hosts: fortigate
  connection: httpapi
  gather_facts: no
  vars_files: 
    - main.yml
    - "{{infra}}.yml"  
  roles:
    # - fortigate_change_password # no permissions via API
    - fortigate_config_network
    - fortigate_create_rules
    - fortigate_connect_fortianalyzer
    - fortigate_gather_facts


---

- name: Configure admin password
  fortinet.fortios.fortios_system_admin:
    vdom: "{{ domain }}"
    state: present
    system_admin:
      name: admin
      password: "{{ new_password }}"
      force_password_change: "disable"

# - name: Add a FortiCare license in FortiGate
#   fortinet.fortios.fortios_registration_forticare:
#     vdom:  "{{ vdom }}"
#     registration_forticare:
#       registration_code: "{{ serial }}"

- name: Update VM license using uploaded file (reboots immediately if successful).
  fortios_system_vmlicense:
    vdom:  "{{ vdom }}"
    system_vmlicense:
      file_content: "{{ encoded_license }}"
  vars:
    license_file: ./FGVMXXXXXX-VM00.lic
    license_file_content: "{{ lookup( 'file', license_file) }}"
    encoded_license: "{{ license_file_content | string | b64encode }}"
